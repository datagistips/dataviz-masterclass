legend.position="bottom",
legend.title=element_blank(),
legend.text=element_text(size = 8)) +
scale_y_continuous(sec.axis = dup_axis()) +
# scale_y_log10() +
scale_fill_discrete(
name = "Flux\nd'artificialisation\n2009-2020",
labels = myLevels,
guide = guide_legend(reverse = TRUE)
)
# Filtre des données
statsAix <- f %>%
getStatsComm("13001") %>%
filter(str_detect(variable, "art"))
# Libellés
statsAix <- statsAix %>% mutate(variable = case_when(
variable == "arthab0920" ~ "Habitat",
variable == "artact0920" ~ "Activité",
variable == "artmix0920" ~ "Mixte",
variable == "artinc0920" ~ "Inconnu",
))
# Surfaces en Ha
statsAix$value <- statsAix$value / 10000
# Ordre des barres
# Les plus grands flux en premier
statsAix$variable <- as.character(statsAix$variable)
myLevels <- statsAix$variable[order(statsAix$value)]
statsAix$variable <- factor(statsAix$variable, levels = myLevels)
# Plot
ggplot(data = statsAix,
aes(x = variable,
y = value,
fill = variable)) +
geom_bar(stat = "identity") +
coord_flip() +
theme(
axis.text.y=element_blank(),
axis.ticks.y=element_blank(),
axis.title.x=element_blank(),
axis.title.y=element_blank(),
panel.background=element_blank(),
panel.border=element_blank(),
panel.grid.major=element_blank(),
panel.grid.minor=element_blank(),
legend.position="bottom",
legend.title=element_blank(),
legend.text=element_text(size = 8)) +
scale_y_continuous(sec.axis = dup_axis()) +
scale_y_log10() +
scale_fill_discrete(
name = "Flux\nd'artificialisation\n2009-2020",
labels = myLevels,
guide = guide_legend(reverse = TRUE)
)
?sg_x_axis
?sg_axis_x
?sg_axis_y
?streamgraph
f <- read.csv2("../data/obs_artif_conso_com_2009_2020_V2.csv", sep=",", encoding = "UTF-8")
glimpse(f)
f <- read.csv2("../data/obs_artif_conso_com_2009_2020_V2.csv")
glimpse(f)
f <- read_csv("../data/obs_artif_conso_com_2009_2020_V2.csv")
glimpse(f)
class(f$surfcom20)
w <- grep("^[0-9]*$", f$surfcom20, perl = TRUE)
f$surfcom20[-w] %>% unique
w <- grep("^[0-9]*$", f$surfcom20, perl = TRUE)
f$surfcom20[-w]
f$iddep[-w]
f$iddep[-w] %>% unique
f$surfcom20 <- as.integer(f$surfcom20)
f
fAix <- f %>% filter(idcom == "13001")
fAix <- f %>% filter(idcom == "13001")
kable(fAix)
fAix <- f %>% filter(idcom == "13001")
kable(fAix[, myCols])
myCols <- c("idcom", "idcomtxt", "iddep", "iddeptxt", "idreg", "idregtxt", "surfcom20",
"arthab0920", "artact0920", "artmix0920", "artinc0920")
fAix <- f %>% filter(idcom == "13001")
kable(fAix[, myCols])
library(knitr)
fAixLong <- gather(fAix, "variable", "value",
c("arthab0920", "artact0920", "artmix0920", "artinc0920", "surfcom20"))
kable(fAixLong)
library(knitr)
fAixLong <- gather(fAix[, myCols], "variable", "value",
c("arthab0920", "artact0920", "artmix0920", "artinc0920", "surfcom20"))
kable(fAixLong)
fd13 <- f[, myCols] %>%
filter(iddep == "13") %>%
summarize(iddep = first(iddep),
iddeptxt = first(iddeptxt),
idreg = first(idcom),
idregtxt = first(idregtxt),
arthab0920 = sum(arthab0920),
artact0920 = sum(artact0920),
artmix0920 = sum(artmix0920),
artinc0920 = sum(artinc0920),
surfcom20 = sum(surfcom20)) # !! not integer
fd13Long <- gather(fd13, "variable", "value",
c("arthab0920", "artact0920", "artmix0920", "artinc0920", "surfcom20"))
kable(fd13Long)
library(ggplot2)
statsAix <- f2 %>%
getStatsComm("13001") %>%
filter(str_detect(variable, "art"))
ggplot(data = statsAix,
aes(x = variable,
y = value,
fill = variable)) +
geom_bar(stat = "identity")
library(ggplot2)
statsAix <- f %>%
getStatsComm("13001") %>%
filter(str_detect(variable, "art"))
ggplot(data = statsAix,
aes(x = variable,
y = value,
fill = variable)) +
geom_bar(stat = "identity")
# Filtre des données
statsAix <- f %>%
getStatsComm("13001") %>%
filter(str_detect(variable, "art"))
# Libellés
statsAix <- statsAix %>% mutate(variable = case_when(
variable == "arthab0920" ~ "Habitat",
variable == "artact0920" ~ "Activité",
variable == "artmix0920" ~ "Mixte",
variable == "artinc0920" ~ "Inconnu",
))
# Surfaces en Ha
statsAix$value <- statsAix$value / 10000
# Ordre des barres
# Les plus grands flux en premier
statsAix$variable <- as.character(statsAix$variable)
myLevels <- statsAix$variable[order(statsAix$value)]
statsAix$variable <- factor(statsAix$variable, levels = myLevels)
# Plot
ggplot(data = statsAix,
aes(x = variable,
y = value,
fill = variable)) +
geom_bar(stat = "identity") +
coord_flip() +
theme(
axis.text.y=element_blank(),
axis.ticks.y=element_blank(),
axis.title.x=element_blank(),
axis.title.y=element_blank(),
panel.background=element_blank(),
panel.border=element_blank(),
panel.grid.major=element_blank(),
panel.grid.minor=element_blank(),
legend.position="bottom",
legend.title=element_blank(),
legend.text=element_text(size = 8)) +
scale_y_continuous(sec.axis = dup_axis()) +
scale_y_log10() +
scale_fill_discrete(
name = "Flux\nd'artificialisation\n2009-2020",
labels = myLevels,
guide = guide_legend(reverse = TRUE)
)
# Filtre des données
statsAix <- f %>%
getStatsComm("13001") %>%
filter(str_detect(variable, "art"))
# Libellés
statsAix <- statsAix %>% mutate(variable = case_when(
variable == "arthab0920" ~ "Habitat",
variable == "artact0920" ~ "Activité",
variable == "artmix0920" ~ "Mixte",
variable == "artinc0920" ~ "Inconnu",
))
# Surfaces en Ha
statsAix$value <- statsAix$value / 10000
# Ordre des barres
# Les plus grands flux en premier
statsAix$variable <- as.character(statsAix$variable)
myLevels <- statsAix$variable[order(statsAix$value)]
statsAix$variable <- factor(statsAix$variable, levels = myLevels)
# Plot
ggplot(data = statsAix,
aes(x = variable,
y = value,
fill = variable)) +
geom_bar(stat = "identity") +
coord_flip() +
theme(
axis.text.y=element_blank(),
axis.ticks.y=element_blank(),
axis.title.x=element_blank(),
axis.title.y=element_blank(),
panel.background=element_blank(),
panel.border=element_blank(),
panel.grid.major=element_blank(),
panel.grid.minor=element_blank(),
legend.position="bottom",
legend.title=element_blank(),
legend.text=element_text(size = 8)) +
scale_y_log10(sec.axis = dup_axis()) +
scale_fill_discrete(
name = "Flux\nd'artificialisation\n2009-2020",
labels = myLevels,
guide = guide_legend(reverse = TRUE)
)
?hcl
# Filtre des données
statsAix <- f %>%
getStatsComm("13001") %>%
filter(str_detect(variable, "art"))
# Libellés
statsAix <- statsAix %>% mutate(variable = case_when(
variable == "arthab0920" ~ "Habitat",
variable == "artact0920" ~ "Activité",
variable == "artmix0920" ~ "Mixte",
variable == "artinc0920" ~ "Inconnu",
))
# Surfaces en Ha
statsAix$value <- statsAix$value / 10000
# Ordre des barres
# Les plus grands flux en premier
statsAix$variable <- as.character(statsAix$variable)
myLevels <- statsAix$variable[order(statsAix$value)]
statsAix$variable <- factor(statsAix$variable, levels = myLevels)
# Couleurs
palette <- c("Habitat"  = colorBlue,
"Activité" = colorRed,
"Mixte"    = colorMagenta,
"Inconnu"  = colorGrey)
# Plot
ggplot(data = statsAix,
aes(x = variable,
y = value,
fill = variable)) +
geom_bar(stat = "identity") +
coord_flip() +
theme(
axis.text.y=element_blank(),
axis.ticks.y=element_blank(),
axis.title.x=element_blank(),
axis.title.y=element_blank(),
panel.background=element_blank(),
panel.border=element_blank(),
panel.grid.major=element_blank(),
panel.grid.minor=element_blank(),
legend.position="bottom",
legend.title=element_blank(),
legend.text=element_text(size = 8)) +
scale_y_log10(sec.axis = dup_axis()) +
scale_fill_manual(
name = "Flux\nd'artificialisation\n2009-2020",
labels = myLevels,
values = palette[myLevels],
guide = guide_legend(reverse = TRUE)
)
makePlot <- function(f, codesInsees) {
# Filtre des données
myStats <- f %>%
getStatsComm(codesInsees) %>%
filter(str_detect(variable, "art")) # Pas la colonne surfcom20
# Libellés
myStats <- myStats %>% mutate(variable = case_when(
variable == "arthab0920" ~ "Habitat",
variable == "artact0920" ~ "Activité",
variable == "artmix0920" ~ "Mixte",
variable == "artinc0920" ~ "Inconnu",
))
# Surfaces en Ha
myStats$value <- myStats$value / 10000
# Ordre des barres
# Les plus grands flux en premier
myStats$variable <- as.character(myStats$variable)
myLevels <- myStats$variable[order(myStats$value)]
myStats$variable <- factor(myStats$variable, levels = myLevels)
# Couleurs
palette <- c("Habitat"  = colorBlue,
"Activité" = colorRed,
"Mixte"    = colorMagenta,
"Inconnu"  = colorGrey)
# Plot
ggplot(data = myStats,
aes(x = variable,
y = value,
fill = variable)) +
geom_bar(stat = "identity") +
coord_flip() +
theme(
axis.text.y=element_blank(),
axis.ticks.y=element_blank(),
axis.title.x=element_blank(),
axis.title.y=element_blank(),
panel.background=element_blank(),
panel.border=element_blank(),
panel.grid.major=element_blank(),
panel.grid.minor=element_blank(),
legend.position="bottom",
legend.title=element_blank(),
legend.text=element_text(size = 8)) +
scale_y_log10(sec.axis = dup_axis()) +
scale_fill_manual(
name = "Flux\nd'artificialisation\n2009-2020",
labels = myLevels,
values = palette[myLevels],
guide = guide_legend(reverse = TRUE)
)
}
makePlot(f, "13001")
makePlot(f, c("13001", "13041"))
comms <- st_read("C:/Users/mathieu.rajerison/Documents/DATAS/ADMIN-EXPRESS-COG_2-1__SHP__FRA_L93_2020-03-25/ADMIN-EXPRESS-COG_2-1__SHP__FRA_2020-03-25/ADMIN-EXPRESS-COG/1_DONNEES_LIVRAISON_2020-03-25/ADE-COG_2-1_SHP_LAMB93_FR/COMMUNE_CARTO.shp")
codesInsees <- comms %>% filter(CODE_EPCI == "200054807") %>% pull(INSEE_COM)
makePlot(f, codesInsees)
ggplot(myStats, aes(x = variable,
y = value,
fill = variable)) +
geom_bar(stat = "identity", width = 1)
myStats <- data.frame(variable = c("Habitat", "Activité", "Mixte", "Inconnu"),
value = c(100, 95, 105, 98))
ggplot(fooStats, aes(x = variable,
y = value,
fill = variable)) +
geom_bar(stat = "identity", width = 1)
fooStats <- data.frame(variable = c("Habitat", "Activité", "Mixte", "Inconnu"),
value = c(100, 95, 105, 98))
ggplot(fooStats, aes(x = variable,
y = value,
fill = variable)) +
geom_bar(stat = "identity", width = 1)
ggplot(fooStats, aes(x = "",
y = value,
fill = variable)) +
geom_bar(stat = "identity", width = 1) +
coord_polar("y", start = 0)
comms <- st_read("C:/Users/mathieu.rajerison/Documents/DATAS/ADMIN-EXPRESS-COG_2-1__SHP__FRA_L93_2020-03-25/ADMIN-EXPRESS-COG_2-1__SHP__FRA_2020-03-25/ADMIN-EXPRESS-COG/1_DONNEES_LIVRAISON_2020-03-25/ADE-COG_2-1_SHP_LAMB93_FR/COMMUNE_CARTO.shp") %>% st_set_crs(2154) %>% st_transform(4326)
coords <- c(xmin = 5.884806, ymin = 42.99066, xmax = 6.439616, ymax = 43.39115)
bb <- st_bbox(coords, crs = st_crs(4326)) %>% st_as_sfc
i <- comms %>% st_intersects(bb)
i
w <- which(sapply(i, function(x) length(x) != 0))
codesInsees <- comms2 %>% slice(w) %>% pull(INSEE_COM)
w <- which(sapply(i, function(x) length(x) != 0))
codesInsees <- comms %>% slice(w) %>% pull(INSEE_COM)
codesInsees
getCommsInBB <- function(comms2, xmin, ymin, xmax, ymax) {
bb <- st_bbox(c(xmin = xmin, ymin = ymin, xmax = xmax, ymax = ymax), crs = st_crs(4326)) %>% st_as_sfc
i <- comms2 %>% st_intersects(bb)
w <- which(sapply(i, function(x) length(x) != 0))
codesInsees <- comms2 %>% slice(w) %>% pull(INSEE_COM)
codesInsees
}
getCommsInBB(comms2, xmin = 5.884806, ymin = 42.99066, xmax = 6.439616, ymax = 43.39115)
getCommsInBB <- function(comms, xmin, ymin, xmax, ymax) {
bb <- st_bbox(c(xmin = xmin, ymin = ymin, xmax = xmax, ymax = ymax), crs = st_crs(4326)) %>% st_as_sfc
i <- comms %>% st_intersects(bb)
w <- which(sapply(i, function(x) length(x) != 0))
codesInsees <- comms %>% slice(w) %>% pull(INSEE_COM)
codesInsees
}
getCommsInBB(comms, xmin = 5.884806, ymin = 42.99066, xmax = 6.439616, ymax = 43.39115)
codesInsees <- getCommsInBB(comms, xmin = 5.884806, ymin = 42.99066, xmax = 6.439616, ymax = 43.39115)
makePlot(flux, codesInsees)
fluxAix <- flux %>% filter(idcom == "13001")
kable(fluxAix[, myCols])
library(knitr)
fluxAixL <- gather(fluxAix[, myCols], "variable", "value",
c("arthab0920", "artact0920", "artmix0920", "artinc0920", "surfcom20"))
kable(fluxAixL)
shiny::runApp('shinyapp/app1')
# Flux
flux <<- readRDS("flux.rds") %>% filter(str_detect(idcom, "^(04|05|06|13|83|84)") == "93")
setwd("shinyapp")
flux <<- readRDS("flux.rds") %>% filter(str_detect(idcom, "^(04|05|06|13|83|84)") == "93")
setwd("shinyapp/app1")
setwd("app1")
flux <<- readRDS("flux.rds") %>% filter(str_detect(idcom, "^(04|05|06|13|83|84)") == "93")
library(tidyverse)
flux <<- readRDS("flux.rds") %>% filter(str_detect(idcom, "^(04|05|06|13|83|84)") == "93")
nrow(flux)
?str_detect
flux <<- readRDS("flux.rds") %>% filter(str_detect(idcom, "^(04|05|06|13|83|84)"))
flux
runApp()
runApp()
runApp()
runApp()
readRDS("comms.rds")
runApp()
runApp()
runApp()
coords <- c(5.974598, 44.0858)
pt <- coords %>% st_point %>% st_sfc
pt
pt <- coords %>% st_point %>% st_sfc %>% st_set_crs(4326)
i <- st_intersects(comms, i)
i <- st_intersects(comms, pt)
i
unlist(i)
?st_intersects
sapply(i, function(x) length(i) > 0)
sapply(i, function(x) length(i[[1]]) > 0)
sapply(i, function(x) length(i[[1]]) > 0) %>% which
runApp()
coords <- c(5.96021, 43.56232)
pt <- coords %>% st_point %>% st_sfc %>% st_set_crs(4326)
i <- st_intersects(comms, pt)
which(sapply(i, function(x) length(x) != 0))
runApp()
runApp()
runApp()
runApp()
flux %>% makeStream("13001")
codeInsee <- "13001"
df <- flux %>% getStatsFlux(codeInsee)
df
# L'ordre des inverse dans les streamgraphs
df$type <- factor(df$type, levels = c("Inconnu", "Mixte", "Activité", "Habitat"))
# Plot
df %>%
streamgraph("type", "value", "year", sort = FALSE) %>%
sg_axis_x(1, "Année", "%Y") %>%
sg_fill_manual(rev(palette))
palette
runApp()
runApp()
runApp()
glue("color:{pal['red']}")
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
shiny::runApp('shinyapp/app1')
comms <- st_read("C:/Users/mathieu.rajerison/Documents/DATAS/ADMIN-EXPRESS-COG_2-1__SHP__FRA_L93_2020-03-25/ADMIN-EXPRESS-COG_2-1__SHP__FRA_2020-03-25/ADMIN-EXPRESS-COG/1_DONNEES_LIVRAISON_2020-03-25/ADE-COG_2-1_SHP_LAMB93_FR/COMMUNE_CARTO.shp") %>% st_set_crs(2154) %>% st_transform(4326)
library(sf)
library(tidyverse)
comms <- st_read("C:/Users/mathieu.rajerison/Documents/DATAS/ADMIN-EXPRESS-COG_2-1__SHP__FRA_L93_2020-03-25/ADMIN-EXPRESS-COG_2-1__SHP__FRA_2020-03-25/ADMIN-EXPRESS-COG/1_DONNEES_LIVRAISON_2020-03-25/ADE-COG_2-1_SHP_LAMB93_FR/COMMUNE_CARTO.shp") %>% st_set_crs(2154) %>% st_transform(4326)
st_coordinates(comms %>% filter(INSEE_COM == "13001"))
st_coordinates(comms %>% filter(INSEE_COM == "13001") %>% st_centroid)
pt <- c(5.398602, 43.53609) %>% st_point %>% st_sfc %>% st_set_crs(4326)
i <- st_intersects(comms, pt)
w <- which(sapply(i, function(x) length(x) != 0))
codeInsee <- comms$INSEE_COM[w]
codeInsee
getCommCenter <- function(comms, coords) {
pt <- coords %>% st_point %>% st_sfc %>% st_set_crs(4326)
i <- st_intersects(comms, pt)
w <- which(sapply(i, function(x) length(x) != 0))
codeInsee <- comms$INSEE_COM[w]
return(codeInsee)
}
comms %>% getCommCenter(c(5.398602, 43.53609))
shiny::runApp('shinyapp-old/app1')
runApp('shinyapp-old/app1')
runApp('shinyapp-old/app1')
runApp('shinyapp-old/app1')
runApp('shinyapp-old/app1')
runApp('shinyapp-old/app1')
runApp('shinyapp-old/app1')
runApp('shinyapp-old/app1')
palette$bleu
palette_cerema$bleu
paletteCerema$bleu
paletteCerema <- fromJSON(file = "palette_cerema.json")
runApp('shinyapp-old/app1')
setwd("shinyapp-old")
setwd("app1")
paletteCerema <- fromJSON(file = "palette_cerema.json")
paletteCerema$secondaire$bleu
palettCerema
paletteCerema
runApp()
paletteCerema
runApp()
paletteCerema
formatC(1000, big.mark=" ")  # 1,001
formatC(1024, big.mark=" ")  # 1,001
runApp()
format(as.numeric(1000876576655), nsmall=1, big.mark=",")  # 1,000.6
format(as.numeric(1000876576655), nsmall=1, big.mark=",", scientific = FALSE)  # 1,000.6
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp('C:/Users/mathieu.rajerison/Desktop/TAFF_MAISON/B_REUNIONS/2111-ATELIER-DATAVIZ/shinyapp')
rm(list=ls())
runApp('C:/Users/mathieu.rajerison/Desktop/TAFF_MAISON/B_REUNIONS/2111-ATELIER-DATAVIZ/shinyapp')
rm(list=ls())
runApp('C:/Users/mathieu.rajerison/Desktop/TAFF_MAISON/B_REUNIONS/2111-ATELIER-DATAVIZ/shinyapp')
runApp('C:/Users/mathieu.rajerison/Desktop/TAFF_MAISON/B_REUNIONS/2111-ATELIER-DATAVIZ/shinyapp')
runApp('C:/Users/mathieu.rajerison/Desktop/TAFF_MAISON/B_REUNIONS/2111-ATELIER-DATAVIZ/shinyapp')
runApp('C:/Users/mathieu.rajerison/Desktop/TAFF_MAISON/B_REUNIONS/2111-ATELIER-DATAVIZ/shinyapp')
comms <- st_read("../data/COMMUNE_CARTO.shp") %>% st_set_crs(2154) %>% st_transform(4326)
library(sf)
library(tidyverse)
comms <- st_read("../data/COMMUNE_CARTO.shp") %>% st_set_crs(2154) %>% st_transform(4326)
comms <- readRDS("notebook/comms.rds")
saveRDS(comms %>% filter(INSEE_REG == 93), "../data/comms.rds")
saveRDS(comms %>% filter(INSEE_REG == 93), "data/comms.rds")
shiny::runApp('shinyapp')
